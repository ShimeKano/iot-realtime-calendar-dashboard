<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard AQI Th·ªùi Gian Th·ª±c & L·ªãch S·ª≠</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f7fa;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    .box {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
    }

    .controls {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    canvas {
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <div class="box">
    <h1>üìä L·ªãch s·ª≠ AQI ‚Äì H√† N·ªôi</h1>

    <div class="controls">
      <input type="date" id="datePicker" />
      <button onclick="loadHistory()">Xem d·ªØ li·ªáu</button>
    </div>

    <canvas id="aqiChart"></canvas>
  </div>

  <script>
    let chart;

    async function loadHistory() {
      const date = document.getElementById("datePicker").value;
      let url = "/api/GetHistory";
      if (date) url += "?date=" + date;

      const res = await fetch(url);
      const json = await res.json();

      const labels = json.data.map(d => d.time);
      const aqiData = json.data.map(d => d.aqi);

      drawChart(labels, aqiData);
    }

    function drawChart(labels, data) {
      const ctx = document.getElementById("aqiChart");

      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: labels,
          datasets: [{
            label: "AQI",
            data: data,
            borderColor: "red",
            backgroundColor: "rgba(255,0,0,0.2)",
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              title: {
                display: true,
                text: "Ch·ªâ s·ªë AQI"
              }
            },
            x: {
              title: {
                display: true,
                text: "Th·ªùi gian"
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
